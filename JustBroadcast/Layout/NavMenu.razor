@using Microsoft.AspNetCore.Components.Authorization
@using JustBroadcast.Services
@using JustBroadcast.Models
@inject IAuthService AuthService

<div class="nav-header">
    <div class="logo">
        <i class="fas fa-broadcast-tower"></i>
        <h3>Just Broadcast</h3>
    </div>
    <p class="logo-subtitle">Control Center</p>
</div>

<nav class="nav-menu">
    @if (userInfo != null)
    {
        <!-- Main Menu with All Playouts submenu -->
        <div class="nav-section">
            <div class="nav-item">
                <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                    <i class="fas fa-home"></i>
                    <span>Main</span>
                </NavLink>
            </div>

            <!-- All Playouts Submenu -->
            @if (userInfo.AllPlayouts != null && userInfo.AllPlayouts.Any())
            {
                <div class="nav-subsection">
                    <div class="nav-item">
                        <NavLink class="nav-link nav-sublink" href="all-playouts">
                            <i class="fas fa-th-list"></i>
                            <span>All Playouts</span>
                        </NavLink>
                    </div>
                    @foreach (var playout in userInfo.AllPlayouts)
                    {
                        <div class="nav-item">
                            <NavLink class="nav-link nav-sublink" href="@($"playout/{playout.Id}")">
                                <i class="fas fa-desktop"></i>
                                <span>@playout.Name</span>
                                @if (playout.Spare == true)
                                {
                                    <i class="fas fa-trash" title="Spare"></i>
                                }
                            </NavLink>
                        </div>
                    }
                </div>
            }
        </div>

        <!-- Administration Section (Supervisor & Administrator only) -->
        @if (CanShowAdministration())
        {
            <div class="nav-section">
                <div class="nav-section-title">
                    <i class="fas fa-cog"></i>
                    <span>Administration</span>
                    <i class="fas fa-chevron-up collapse-icon"></i>
                </div>
                <div class="nav-subsection">
                    <div class="nav-item">
                        <NavLink class="nav-link nav-sublink" href="admin/users">
                            <i class="fas fa-users"></i>
                            <span>Users</span>
                        </NavLink>
                    </div>
                    <div class="nav-item">
                        <NavLink class="nav-link nav-sublink" href="admin/channels">
                            <i class="fas fa-tv"></i>
                            <span>Channels</span>
                        </NavLink>
                    </div>
                    <div class="nav-item">
                        <NavLink class="nav-link nav-sublink" href="admin/playouts">
                            <i class="fas fa-server"></i>
                            <span>Playouts</span>
                        </NavLink>
                    </div>
                    <div class="nav-item">
                        <NavLink class="nav-link nav-sublink" href="admin/settings">
                            <i class="fas fa-sliders-h"></i>
                            <span>Settings</span>
                        </NavLink>
                    </div>
                </div>
            </div>
        }

        <!-- Playout Control Section (Dynamic from RemotePlayouts) -->
        @if (CanShowPlayoutControl())
        {
            <div class="nav-section">
                <div class="nav-section-title">
                    <i class="fas fa-play-circle"></i>
                    <span>Playout Control</span>
                    <i class="fas fa-chevron-up collapse-icon"></i>
                </div>
                <div class="nav-subsection">
                    @foreach (var playout in userInfo.RemotePlayouts!)
                    {
                        var displayName = !string.IsNullOrEmpty(playout.Channel)
                            ? $"{playout.Name} - {playout.Channel}"
                            : playout.Name;

                        <div class="nav-item">
                            <NavLink class="nav-link nav-sublink" href="@($"playout-control/{playout.Id}")">
                                <i class="fas fa-desktop"></i>
                                <span>@displayName</span>
                                @if (playout.Spare == true)
                                {
                                    <i class="fas fa-trash" title="Spare"></i>
                                }
                            </NavLink>
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Scheduler Section (Dynamic from SchedulerChannels) -->
        @if (CanShowScheduler())
        {
            <div class="nav-section">
                <div class="nav-section-title">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Scheduler</span>
                    <i class="fas fa-chevron-up collapse-icon"></i>
                </div>
                <div class="nav-subsection">
                    @foreach (var channel in userInfo.SchedulerChannels!)
                    {
                        <div class="nav-item">
                            <NavLink class="nav-link nav-sublink" href="@($"scheduler/{channel.Id}")">
                                <i class="fas fa-tv"></i>
                                <span>@channel.Name</span>
                            </NavLink>
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Phase 2 Menu Items (CG Editor, CG Control, Multiview) -->
        <div class="nav-section phase2-section">
            <div class="nav-item">
                <NavLink class="nav-link" href="cg-editor">
                    <i class="fas fa-font"></i>
                    <span>CG Editor</span>
                </NavLink>
            </div>
            <div class="nav-item">
                <NavLink class="nav-link" href="cg-control">
                    <i class="fas fa-layer-group"></i>
                    <span>CG Control</span>
                </NavLink>
            </div>
            <div class="nav-item">
                <NavLink class="nav-link" href="multiview">
                    <i class="fas fa-th"></i>
                    <span>Multiview</span>
                </NavLink>
            </div>
        </div>
    }
</nav>

<div class="nav-footer">
    @if (userInfo != null)
    {
        <div class="user-profile">
            <div class="user-avatar">@GetUserInitial()</div>
            <div class="user-details">
                <div class="user-name">@(userInfo.Username ?? userInfo.Name ?? "User")</div>
                <div class="user-email">@GetRoleName()</div>
            </div>
        </div>
    }
</div>


